---
- name: Check hostname standards
  hosts: all
  gather_facts: false

  vars:
    # Regular expressions for validation
    server_pattern: '^(prod|test|dev|stage)-[a-z0-9]+-[a-z]+-\d{2}$'
    pc_pattern: '^[a-z]+-(linux|windows|macos)-\d{3}$'

  tasks:
    - name: Check servers in dmz and servers groups
      block:
        - name: Validate server name
          fail:
            msg: "❌ SERVER '{{ inventory_hostname }}' is INVALID! Must be: prod-role-location-01 (Example: prod-web-dmz-01)"
          when: not inventory_hostname is regex(server_pattern)
          ignore_errors: yes

        - name: Show success for servers
          debug:
            msg: "✅ SERVER '{{ inventory_hostname }}' is CORRECT"
          when: inventory_hostname is regex(server_pattern)
      when: "'dmz' in group_names or 'servers' in group_names"

    - name: Check user PCs in users group
      block:
        - name: Validate PC name
          fail:
            msg: "❌ USER PC '{{ inventory_hostname }}' is INVALID! Must be: username-os-001 (Example: petrovich-linux-001)"
          when: not inventory_hostname is regex(pc_pattern)
          ignore_errors: yes

        - name: Show success for user PCs
          debug:
            msg: "✅ USER PC '{{ inventory_hostname }}' is CORRECT"
          when: inventory_hostname is regex(pc_pattern)
      when: "'users' in group_names"

    - name: Show warning for hosts without proper groups
      debug:
        msg: "⚠️  Host '{{ inventory_hostname }}' is not in any checked groups (dmz, servers, users)"
      when: 
        - "'dmz' not in group_names"
        - "'servers' not in group_names"
        - "'users' not in group_names"